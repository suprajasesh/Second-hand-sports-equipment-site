"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.serverlessGenerator = void 0;
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
const eslint_1 = require("@nx/eslint");
const node_1 = require("@nx/node");
const setup_functions_1 = require("../setup-functions/setup-functions");
function normalizeOptions(options) {
    var _a, _b, _c;
    const { projectDirectory } = (0, devkit_1.extractLayoutDirectory)(options.directory);
    const appDirectory = projectDirectory
        ? `${(0, devkit_1.names)(projectDirectory).fileName}/${(0, devkit_1.names)(options.name).fileName}`
        : (0, devkit_1.names)(options.name).fileName;
    const appProjectName = appDirectory.replace(new RegExp('/', 'g'), '-');
    return Object.assign(Object.assign({}, options), { name: (0, devkit_1.names)(appProjectName).fileName, lintTarget: (_a = options.lintTarget) !== null && _a !== void 0 ? _a : 'lint', linter: (_b = options.linter) !== null && _b !== void 0 ? _b : eslint_1.Linter.EsLint, unitTestRunner: (_c = options.unitTestRunner) !== null && _c !== void 0 ? _c : 'jest' });
}
function serverlessGenerator(tree, schema) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const options = normalizeOptions(schema);
        const tasks = [];
        const init = yield (0, node_1.applicationGenerator)(tree, Object.assign(Object.assign({}, options), { framework: 'none', e2eTestRunner: 'none', rootProject: true }));
        tasks.push(init);
        const addServerlessTask = yield (0, setup_functions_1.setupFunctionsGenerator)(tree, Object.assign(Object.assign({}, options), { project: options.name }));
        tree.delete('tools');
        tree.delete('src');
        tasks.push(addServerlessTask);
        return (0, devkit_1.runTasksInSerial)(...tasks);
    });
}
exports.serverlessGenerator = serverlessGenerator;
exports.default = serverlessGenerator;
//# sourceMappingURL=serverless.js.map